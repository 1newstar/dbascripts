--查询这个等待事件类型的有多少session
SELECT D.SQL_ID, COUNT(1)
  FROM DBA_HIST_ACTIVE_SESS_HISTORY D
 WHERE D.SAMPLE_TIME BETWEEN
       TO_DATE('2017-06-15 17:00:00', 'YYYY-MM-DD HH24:MI:SS') AND
       TO_DATE('2017-06-15 17:30:00', 'YYYY-MM-DD HH24:MI:SS')
   AND D.EVENT = 'enq: TX - row lock contention'
 GROUP BY D.SQL_ID;

--查询delete这条sql有多少session
SELECT D.SQL_ID, COUNT(1)
  FROM DBA_HIST_ACTIVE_SESS_HISTORY D
 WHERE D.SAMPLE_TIME BETWEEN
       TO_DATE('2017-06-15 17:00:00', 'YYYY-MM-DD HH24:MI:SS') AND
       TO_DATE('2017-06-15 17:30:00', 'YYYY-MM-DD HH24:MI:SS')
   AND D.EVENT = 'enq: TX - row lock contention'
   AND D.SQL_ID = 'd0ya2yqarj9bf'
 GROUP BY D.SQL_ID;

--查看锁的类型
SELECT D.SQL_ID,
       CHR(BITAND(P1, -16777216) / 16777215) ||
       CHR(BITAND(P1, 16711680) / 65535) "Lock",
       BITAND(P1, 65535) "Mode",
       COUNT(1),
       COUNT(DISTINCT D.SESSION_ID)
  FROM DBA_HIST_ACTIVE_SESS_HISTORY D
 WHERE D.SAMPLE_TIME BETWEEN
       TO_DATE('2017-06-15 17:00:00', 'YYYY-MM-DD HH24:MI:SS') AND
       TO_DATE('2017-06-15 17:30:00', 'YYYY-MM-DD HH24:MI:SS')
   AND D.EVENT = 'enq: TX - row lock contention'
 GROUP BY D.SQL_ID,
          (CHR(BITAND(P1, -16777216) / 16777215) ||
          CHR(BITAND(P1, 16711680) / 65535)),
          (BITAND(P1, 65535));

--查看sql的执行计划
查看 DELETE FROM ISC_ROLE_RES_R WHERE ID = :1 的执行计划;

--查看绑定的变量是多少
SELECT A.SQL_ID, A.NAME, A.POSITION, A.DATATYPE_STRING, A.VALUE_STRING
  FROM DBA_HIST_SQLBIND A
 WHERE A.SQL_ID IN 'd0ya2yqarj9bf';

--找到绑定的变量后带入
SELECT COUNT(*)
  FROM ISC_ROLE_RES_R
 WHERE ID = 绑定变量的值 ，看有多少条记录
